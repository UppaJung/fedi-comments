"use strict";(()=>{var x=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var A=(e,n)=>{var o={};for(var s in e)k.call(e,s)&&n.indexOf(s)<0&&(o[s]=e[s]);if(e!=null&&x)for(var s of x(e))n.indexOf(s)<0&&P.call(e,s)&&(o[s]=e[s]);return o};var v=(e,n)=>{let o=Date.now()-e.getTime(),s=(a,l)=>{n(a,e),l!=null&&l>0&&setTimeout(()=>v(e,n),l)},c=6e4,t=60*c,i=24*t;if(o<c)s("seconds ago",c-o);else if(o<t){let a=Math.floor(o/c);s("".concat(a," minute").concat(a>1?"s":""," ago"),c-o%c)}else if(o<i){let a=Math.floor(o/t);s("".concat(a," hour").concat(a>1?"s":""," ago"),t-o%t)}else if(o<14*i){let a=Math.floor(o/i);s("".concat(a," day").concat(a>1?"s":""," ago"),i-o%i)}else s(e.toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"}))};var r=(e,t={})=>{var i=t,{attributes:n={},classes:o=[],children:s=[]}=i,c=A(i,["attributes","classes","children"]);let a=document.createElement(e);Object.entries(n).forEach(([l,u])=>a.setAttribute(l,u)),o.forEach(l=>a.classList.add(l));for(let l of["id","textContent","innerHTML"]){let u=c[l];u!=null&&(a[l]=u)}return s.forEach(l=>a.appendChild(l)),a},L=(e,n)=>{let o=e;return n.forEach(s=>{let c=r("source",{attributes:{srcset:s.url,media:"(prefers-reduced-motion: no-preference)"}}),t=r("img",{classes:["emoji"],attributes:{src:s.static_url,alt:":".concat(s.shortcode,":"),title:":".concat(s.shortcode,":")}}),i=r("picture",{children:[c,t]});o=o.replace(":".concat(s.shortcode,":"),i.outerHTML)}),o};var C=async(...e)=>{let n=await fetch(...e);if(!n.ok)throw new Error(n.statusText);return await n.json()},N=({host:e,status:n})=>C("https://".concat(e,"/api/v1/statuses/").concat(n,"/context?limit=1"),{}),Q=async({host:e,status:n})=>C("https://".concat(e,"/api/v1/statuses/").concat(n,", {});"));var _=e=>{var c;let{host:n,pathname:o}=new URL(e),s=(c=o.split("/")[2])!=null?c:"";return{host:n,status:s}},j=async e=>{let n=typeof e=="string"?_(e):e,[o,s]=await Promise.all([Q(n),N(n)]);return{original:o,replies:s.descendants}};var O=(e,n)=>{var c;let o=[],s=new Map;for(let t of e){let i=t.account.id===n.id,a=new URL(t.account.url).hostname,l=r("source",{attributes:{srcset:t.account.avatar,media:"(prefers-reduced-motion: no-preference)"}}),u=r("img",{classes:["comment-authors-avatar"],attributes:{src:t.account.avatar_static,alt:"@".concat(t.account.username,"@").concat(a," avatar")}}),d=r("picture",{children:[l,u]}),p=r("a",{classes:["comment-authors-avatar-link",...i?["original-poster"]:[]],attributes:{href:t.account.url,rel:"external nofollow",title:"view profile at @".concat(t.account.username,"@").concat(a)},children:[d]}),b=r("span",{classes:["at-symbol","username-at-symbol"],textContent:"@"}),f=r("span",{classes:["at-symbol","server-at-symbol"],textContent:"@"}),h=r("span",{classes:["comment-authors-fediverse-username"],textContent:t.account.username}),g=r("span",{classes:["comment-authors-fediverse-server"],textContent:a}),y=r("span",{classes:["comment-authors-display-name"],innerHTML:L(t.account.display_name,t.account.emojis),attributes:{itemprop:"author",itemtype:"http://schema.org/Person"}}),m=r("a",{classes:["comment-authors-fediverse-identity",...i?["original-poster"]:[]],attributes:{href:t.account.url,title:"@".concat(t.account.username,"@").concat(a),rel:"external nofollow"},children:[b,h,f,g]}),w=r("div",{classes:["comment-author"],children:[y,m]}),M=r("header",{classes:["comment-header"],children:[p,w]}),D=r("a",{textContent:"original post",attributes:{href:(c=t.url)!=null?c:"",itemprop:"url",title:"view at ".concat(a),rel:"external nofollow"}}),R=r("main",{classes:["comment-content"],innerHTML:L(t.content,t.emojis),attributes:{itemprop:"text"}}),E=r("time",{classes:["comment-time"],attributes:{dateTime:t.created_at},textContent:new Date(t.created_at).toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"})});v(new Date(t.created_at),U=>{E.textContent=U});let H=r("span",{classes:["comment-counters"],children:[...t.reblogs_count>0?[r("a",{classes:["comment-counter-reblogs"],textContent:"".concat(t.reblogs_count),attributes:{href:"".concat(t.url,"/reblogs"),title:"Reblogs reported by ".concat(a)}})]:[],...t.favourites_count>0?[r("a",{classes:["comment-counter-favorites"],textContent:"".concat(t.favourites_count),attributes:{href:"".concat(t.url,"/favourites"),title:"Favorites reported by ".concat(a)}})]:[]]}),I=r("footer",{classes:["comment-footer"],children:[H,D,E]}),S=r("div",{classes:["comment-replies"]});s.set(t.id,S);let $=r("article",{id:"comment-".concat(t.id),classes:["fediverse-comment",...i?["original-poster"]:[]],attributes:{itemprop:"comment",itemtype:"http://schema.org/Comment"},children:[M,R,I,S]}),T=t.in_reply_to_id!=null?s.get(t.in_reply_to_id):void 0;T?T.appendChild($):o.push($)}return o},B=async e=>{var f,h,g,y;let n=(f=e==null?void 0:e.dataset)!=null?f:{},o=new Set(((h=n.include)!=null?h:"").split(",").map(m=>m.trim())),s=new Set(((g=n.exclude)!=null?g:"").split(",").map(m=>m.trim())),c=parseInt((y=n.max)!=null?y:""),t=n.responsesToUrl,{host:i,status:a}=t!=null?_(t):n;if(i==null||a==null)return;let{original:l,replies:u}=await j({host:i,status:a}),d=[l,...u.filter(m=>s.has(m.id)?!1:m.in_reply_to_id!=null&&s.has(m.in_reply_to_id)?(s.add(m.id),!1):!0)];if(!isNaN(c))for(var p=d.length-1;p>0&&d.length>c;p--)o.has(d[p].id)||d.splice(p,1);O(d,l.account).forEach(m=>e.appendChild(m))},F=()=>{let e=document.querySelectorAll("[data-host][data-status], [data-responses-to-url]");for(let n of e)n instanceof HTMLElement&&B(n)};document.addEventListener("DOMContentLoaded",F);})();
//# sourceMappingURL=fedicomments.js.map
