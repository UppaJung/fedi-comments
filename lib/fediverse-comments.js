"use strict";(()=>{var H=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var _=(t,e)=>{var o={};for(var n in t)V.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&H)for(var n of H(t))e.indexOf(n)<0&&J.call(t,n)&&(o[n]=t[n]);return o};var h=t=>{var a;let{host:e,pathname:o}=new URL(t),n=(a=o.split("/")[2])!=null?a:"";return{host:e,status:n}};var C=async(...t)=>{let e=await fetch(...t);if(!e.ok)throw new Error(e.statusText);return await e.json()},K=({host:t,status:e})=>C("https://".concat(t,"/api/v1/statuses/").concat(e,"/context?limit=1"),{}),G=t=>K(t).then(e=>e.descendants),W=async({host:t,status:e})=>C("https://".concat(t,"/api/v1/statuses/").concat(e,", {});")),D=async({host:t,status:e})=>C("https://".concat(t,"/api/v1/statuses/").concat(e,"/reblogged_by"),{}),I=async({host:t,status:e})=>C("https://".concat(t,"/api/v1/statuses/").concat(e,"/favourited_by"),{}),N=async t=>{let e=typeof t=="string"?h(t):t,[o,n]=await Promise.all([W(e),G(e)]);return{original:o,replies:n}};var g=()=>(t,s={})=>{var i=s,{attributes:e={},classes:o=[],children:n=[]}=i,a=_(i,["attributes","classes","children"]);let r=document.createElement(t);Object.entries(e).forEach(([l,p])=>r.setAttribute(l,p)),o.forEach(l=>r.classList.add(l));for(let l of["id","textContent"]){let p=a[l];p!=null&&(r[l]=p)}let{innerHTML:u}=a;if(u)try{let l=new Sanitizer;r.setHTML(u,{sanitizer:l}),console.log("sanitized",u)}catch(l){r.innerHTML=u}return n.forEach(l=>r.appendChild(l)),r};var x=g(),E=(t,e)=>{let o=t;return e.forEach(n=>{let a=x("source",{attributes:{srcset:n.url,media:"(prefers-reduced-motion: no-preference)"}}),s=x("img",{classes:["emoji"],attributes:{src:n.static_url,alt:":".concat(n.shortcode,":"),title:":".concat(n.shortcode,":")}}),i=x("picture",{children:[a,s]});o=o.replace(":".concat(n.shortcode,":"),i.outerHTML)}),o};var S=(t,e)=>{let o=Date.now()-t.getTime(),n=(r,u)=>{e(r,t),u!=null&&u>0&&setTimeout(()=>S(t,e),u)},a=6e4,s=60*a,i=24*s;if(o<a)n("seconds ago",a-o);else if(o<s){let r=Math.floor(o/a);n("".concat(r," minute").concat(r>1?"s":""," ago"),a-o%a)}else if(o<i){let r=Math.floor(o/s);n("".concat(r," hour").concat(r>1?"s":""," ago"),s-o%s)}else if(o<14*i){let r=Math.floor(o/i);n("".concat(r," day").concat(r>1?"s":""," ago"),i-o%i)}else n(t.toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"}))};var c=g(),U=(t,e)=>{var a;let o=[],n=new Map;for(let s of t){let i=s.account.id===e.id,r=new URL(s.account.url).hostname,u=c("source",{attributes:{srcset:s.account.avatar,media:"(prefers-reduced-motion: no-preference)"}}),l=c("img",{classes:["comment-authors-avatar"],attributes:{src:s.account.avatar_static,alt:"@".concat(s.account.username,"@").concat(r," avatar")}}),p=c("picture",{children:[u,l]}),d=c("a",{classes:["comment-authors-avatar-link",...i?["original-poster"]:[]],attributes:{href:s.account.url,rel:"external nofollow",title:"view profile at @".concat(s.account.username,"@").concat(r)},children:[p]}),f=c("span",{classes:["at-symbol","username-at-symbol"],textContent:"@"}),T=c("span",{classes:["at-symbol","server-at-symbol"],textContent:"@"}),y=c("span",{classes:["comment-authors-fediverse-username"],textContent:s.account.username}),v=c("span",{classes:["comment-authors-fediverse-server"],textContent:r}),L=c("span",{classes:["comment-authors-display-name"],innerHTML:E(s.account.display_name,s.account.emojis),attributes:{itemprop:"author",itemtype:"http://schema.org/Person"}}),b=c("a",{classes:["comment-authors-fediverse-identity",...i?["original-poster"]:[]],attributes:{href:s.account.url,title:"@".concat(s.account.username,"@").concat(r),rel:"external nofollow"},children:[f,y,T,v]}),m=c("div",{classes:["comment-author"],children:[L,b]}),j=c("header",{classes:["comment-header"],children:[d,m]}),F=c("a",{textContent:"original post",attributes:{href:(a=s.url)!=null?a:"",itemprop:"url",title:"view at ".concat(r),rel:"external nofollow"}}),O=c("main",{classes:["comment-content"],innerHTML:E(s.content,s.emojis),attributes:{itemprop:"text"}}),w=c("time",{classes:["comment-time"],attributes:{dateTime:s.created_at},textContent:new Date(s.created_at).toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"})});S(new Date(s.created_at),B=>{w.textContent=B});let z=c("span",{classes:["comment-counters"],children:[...s.reblogs_count>0?[c("a",{classes:["comment-counter-reblogs"],textContent:"".concat(s.reblogs_count),attributes:{href:"".concat(s.url,"/reblogs"),title:"Reblogs reported by ".concat(r)}})]:[],...s.favourites_count>0?[c("a",{classes:["comment-counter-favourites"],textContent:"".concat(s.favourites_count),attributes:{href:"".concat(s.url,"/favourites"),title:"favourites reported by ".concat(r)}})]:[]]}),q=c("footer",{classes:["comment-footer"],children:[z,F,w]}),$=c("div",{classes:["comment-replies"]});n.set(s.id,$);let M=c("article",{id:"comment-".concat(s.id),classes:["fediverse-comment",...i?["original-poster"]:[]],attributes:{itemprop:"comment",itemtype:"http://schema.org/Comment"},children:[j,O,q,$]}),R=s.in_reply_to_id!=null?n.get(s.in_reply_to_id):void 0;R?R.appendChild(M):o.push(M)}return o};var X=async t=>{var y,v,L,b;let e=(y=t==null?void 0:t.dataset)!=null?y:{},o=e.hideRootComment!=null&&e.hideRootComment!=="false",n=new Set(((v=e.include)!=null?v:"").split(",").map(m=>m.trim())),a=new Set(((L=e.exclude)!=null?L:"").split(",").map(m=>m.trim().toLocaleLowerCase())),s=parseInt((b=e.max)!=null?b:""),i=e.responsesToUrl,{host:r,status:u}=i!=null?h(i):e;if(r==null||u==null)return;let{original:l,replies:p}=await N({host:r,status:u}),d=[...o?[]:[l],...p.filter(m=>a.has(m.id.toLocaleLowerCase())||a.has(m.account.username.toLocaleLowerCase())||a.has(m.account.id.toLocaleLowerCase())?!1:m.in_reply_to_id!=null&&a.has(m.in_reply_to_id)?(a.add(m.id.toLocaleLowerCase()),!1):!0)];if(!isNaN(s))for(var f=d.length-1;f>0&&d.length>s;f--){let m=d[f];n.has(m.id.toLocaleLowerCase())||a.has(m.account.username.toLocaleLowerCase())||a.has(m.account.id.toLocaleLowerCase())||d.splice(f,1)}U(d,l.account).forEach(m=>t.appendChild(m))},Q=()=>{let t=document.querySelectorAll("[data-host][data-status], [data-responses-to-url]");for(let e of t)e instanceof HTMLElement&&X(e)};var A=g(),Y=t=>{let e=new URL(t.url).hostname,o=A("source",{attributes:{srcset:t.avatar,media:"(prefers-reduced-motion: no-preference)"}}),n=A("img",{classes:["fediverse-account-avatar"],attributes:{src:t.avatar_static,alt:"@".concat(t.username,"@").concat(e," avatar")}}),a=A("picture",{classes:["fediverse-account-avatar"],children:[o,n]});return A("a",{classes:["fediverse-account-avatar-link"],attributes:{href:t.url,rel:"external nofollow",title:"@".concat(t.username,"@").concat(e)},children:[a]})};var k=async(t,e,o)=>{var l,p;let n=(l=o==null?void 0:o.dataset)!=null?l:{},a=new Set(((p=n.exclude)!=null?p:"").split(",").map(d=>d.trim().toLocaleLowerCase())),s=h(e),{host:i,status:r}=s;if(i==null||r==null)return;(await(t==="reblogged"?D(s):I(s))).filter(d=>!a.has(d.id.toLocaleLowerCase())||a.has(d.username.toLocaleLowerCase())).map(Y).forEach(d=>o.appendChild(d))},P=()=>{let t=document.querySelectorAll("[data-reblogged-url]");for(let o of t)if(o instanceof HTMLElement){let n=o.dataset.rebloggedUrl;n!=null&&k("reblogged",n,o)}let e=document.querySelectorAll("[data-favourited-url]");for(let o of e)if(o instanceof HTMLElement){let n=o.dataset.favouritedUrl;n!=null&&k("favourited",n,o)}};document.addEventListener("DOMContentLoaded",()=>{Q(),P()});})();
//# sourceMappingURL=fediverse-comments.js.map
